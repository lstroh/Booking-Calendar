The provided sources offer a deep architectural insight into the Booking Calendar plugin for WordPress, focusing heavily on its core files, AJAX implementation, security measures, background task management, and rendering logic. The sources suggest a significant plugin with both legacy and modern components.

Based on the provided sources, here is a detailed timeline of the main events and architectural developments, followed by a cast of characters.

Detailed Timeline of Main Events & Architectural Developments
Approximate Timeframe / ContextEvent / Architectural DevelopmentDescriptionEarly Development/Legacy PhaseCreation of Legacy Booking LogicThe initial system for creating new bookings and checking date conflicts was established, likely residing in core/lib/wpbc-booking-new.php with the complex wpbc_check_dates_intersections() function.Plugin InitializationCore Class and Shortcode RegistrationThe main plugin controller, wpdev_booking (defined in core/lib/wpdev-booking-class.php), is instantiated. It immediately registers all core shortcodes, including [booking], [bookingcalendar], and [bookingform].Plugin InitializationWidget Registration (Classic UI)The BookingWidget class (in core/lib/wpdev-booking-widget.php) is registered via the widgets_init hook, allowing administrators to place the booking form/calendar in theme sidebars.Plugin InitializationCustom Cron System SetupThe WPBC_Cron class (in core/lib/wpbc-cron.php) hooks its load() method into the WordPress init action (priority 9). This establishes the "pseudo-cron" system that relies on website traffic to check for and execute scheduled tasks (e.g., Google Calendar synchronization).Architectural DecisionEstablishing Security HardeningSecurity files like core/lib/index.php are placed in various directories containing non-public PHP code. This file specifically employs the comment <?php // Silence is golden. ?> to prevent directory listing, a standard WordPress security practice.Plugin SetupAJAX Infrastructure and SecurityThe main AJAX router (core/lib/wpbc-ajax.php) is loaded. It registers numerous AJAX endpoints (wp_ajax_...) for both logged-in users and visitors, ensuring all sensitive actions (approving, deleting, trashing) are protected by nonce verification.Refactoring/ModernizationDeprecation of Legacy Booking LogicThe original booking creation logic is moved out of core/lib/wpbc-booking-new.php and into more modern, centralized files like includes/_capacity/create_booking.php and includes/page-bookings/bookings__actions.php. wpbc_check_dates_intersections() is superseded.User Interaction (Frontend)Calendar Legend FunctionalityThe legend generation logic (in core/lib/wpbc-calendar-legend.php) becomes active. It reads global settings (e.g., booking_is_show_legend) and provides the core functions (wpbc_get_calendar_legend__content_html) to render the calendar status legend (available, pending, approved).User Interaction (Frontend/Admin)Shortcode Parsing and Legend CustomizationThe [legend_items] shortcode is processed via a filter (wpbc_replace_shortcodes_in_booking_form), allowing administrators to place a customized version of the calendar legend inside booking forms.Admin Interaction (Bookings Page)Real-time Booking ManagementAn administrator performs an action (e.g., clicks "Approve"). An AJAX request is sent to core/lib/wpbc-ajax.php, triggering functions like wpbc_ajax_UPDATE_APPROVE().Admin Interaction (Bookings Page)Booking Status Change and ResponseThe AJAX handler executes a direct prepared database query ($wpdb->query()) to update the booking status. It then triggers necessary side-effects, such as sending confirmation emails (wpbc_send_email_approved).Admin Interaction (Bookings Page)UI Update via Inline JSAfter processing, the AJAX handler echoes a <script> block containing calls to JavaScript functions in js/admin.js (e.g., set_booking_row_approved(123)), which updates the admin UI without a page reload.Scheduled MaintenanceCron Task ExecutionOn a subsequent page load, the WPBC_Cron::check() method runs. If a task (like Google Calendar import, wpbc_import_gcal) is due, it updates the booking_cron option with the new last execution time and triggers the corresponding plugin action hook (make_bk_action).Future Development/ExtensionIntegration Points EstablishedA wide variety of action and filter hooks (do_action, make_bk_action, wpbc_ajax_action_list filter) are documented, providing clear paths for developers to extend core functionality, security, and UI components.Plugin DeactivationCron CleanupIf the plugin is deactivated, the WPBC_Cron::deactivate() method is triggered, deleting the booking_cron option from the database to ensure no phantom tasks remain.Cast of Characters (Principle People/Objects)
The sources focus almost exclusively on architectural components and classes rather than named human developers or specific users. The principle "characters" are the core classes and architectural mechanisms that define the plugin's operation.

Character TypeNameBrief BioCore Class / Controllerwpdev_bookingThe main booking class defined in core/lib/wpdev-booking-class.php. It acts as the core controller, registering all front-end shortcodes ([booking], [bookingform], etc.) and providing the essential rendering logic for calendars and forms. It integrates with security (nonces) and user context (auto-fill).AJAX Router / Controllercore/lib/wpbc-ajax.phpThe primary server-side file responsible for handling asynchronous requests from the front-end and admin panel. It registers numerous AJAX actions and executes critical, sensitive business logic, such as approving, trashing, and permanently deleting bookings.Background Task ManagerWPBC_CronThe class defined in core/lib/wpbc-cron.php. It implements a custom, non-native "pseudo-cron" system for scheduling and executing recurring tasks, such as Google Calendar synchronization. It relies on website traffic to trigger its execution via the WordPress init hook.Admin UI ComponentBookingWidgetThe class in core/lib/wpdev-booking-widget.php that extends WP_Widget. It registers the classic "Booking Calendar" widget, allowing administrators to place a form or calendar in theme widget areas. It delegates rendering to the core plugin action hooks.Security Mechanism<?php // Silence is golden. ?>A non-functional piece of PHP code found in files like core/lib/index.php. Its sole purpose is to be served to a browser attempting directory listing, thereby preventing the contents of sensitive directories from being publicly exposed.Legacy Conflict Checkerwpbc_check_dates_intersections()A complex, obsolete function found in core/lib/wpbc-booking-new.php. It was originally responsible for checking date and time conflicts but has been superseded by newer, more reliable capacity and availability logic located in other files.UI Renderercore/lib/wpbc-calendar-legend.phpThe architectural component responsible for generating the HTML and dynamic content for the calendar legend (e.g., showing the meaning of "available" or "pending" status). It consumes settings and supports customization via the [legend_items] shortcode.

