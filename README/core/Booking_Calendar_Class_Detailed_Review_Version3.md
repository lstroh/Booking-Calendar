# Detailed Review: `Booking_Calendar` Class in `core/wpbc.php`

## Overview
The `Booking_Calendar` class is the central singleton controller for the Booking Calendar WordPress plugin.  
It orchestrates plugin initialization, resource loading, admin menu creation, AJAX response handling, compatibility checks, and system integration.

---

## Singleton Pattern

- **Singleton Design:**  
  - Only one instance is allowed (`static private $instance`).
  - Access via static method `init()`.
  - Cloning and unserializing are explicitly forbidden.

---

## Main Properties

- `$cron`: Manages scheduled/recurring tasks (via `WPBC_Cron`).
- `$notice`: Handles admin notices (via `WPBC_Notices`).
- `$booking_obj`: Main booking logic (via `wpdev_booking`).
- `$admin_menu`: Stores admin menu objects (array).
- `$js`, `$css`: Hold JS and CSS loader instances (`WPBC_JS` and `WPBC_CSS`).
- `$is_wp_inited`: Tracks whether WordPress init hook has fired.

---

## Initialization Flow

### 1. `init()`
- Checks for existing instance, creates if missing.
- Loads supporting files (`includes()`), defines plugin version (`define_version()`).
- Hooks into `init` to set `$is_wp_inited`.
- Instantiates installer (`WPBC_BookingInstall`) if present.
- Calls `start()` to initialize booking object and resources.
- Fires custom action `wpbc_booking_calendar_started`.
- If initialization continues (not AJAX or special response):
  - Instantiates JS and CSS handlers.
  - Loads admin or frontend resources and hooks:
    - In admin: sets up menu and footer JS injection.
    - On frontend: sets up booking resource cache, loads CSS/JS, footer scripts.

### 2. `start()`
- **AJAX Mode:**  
  - Creates booking object for AJAX.
  - Loads AJAX responder.
  - Returns `false` (skips UI setup).
- **Admin/Frontend Mode:**  
  - Sets up notices in admin.
  - Instantiates booking logic and cron handler.
  - Returns `true` for further setup.

---

## Admin Menu Definition

- `define_admin_menu()`:  
  Dynamically creates admin menus via `WPBC_Admin_Menus` for:
  - Bookings (main)
  - Add Booking
  - Availability
  - Prices (if premium/business features)
  - Resources or Publish (based on available features)
  - Settings
  - Setup Wizard (if needed)
  - Log Off Simulated User (if applicable)
- Menu titles, badges, and visibility are based on roles, booking counts, and plugin state.

- **Menu Positioning:**  
  - Dynamically sets menu location (top, middle, bottom) based on plugin/config options.

---

## Utility Methods

- `get_menu_object($type)`:  
  Returns the admin menu object for a specific type if it exists.

- `wp_inited()`:  
  Sets `$is_wp_inited` to true when WP `init` fires.

- `is_wp_inited()`:  
  Checks WordPress initialization status.

---

## Supporting Methods

- `includes()`:  
  Loads required files for plugin operation.

- `define_version()`:  
  Reads the plugin header and sets a version constant.

- `__clone()` and `__wakeup()`:  
  Prevent cloning/unserializing to enforce singleton design.

---

## Error Handling & Compatibility

- If multiple plugin instances or version incompatibility is detected, defines and displays admin error notices:
  - Minimum WP version errors.
  - Activation errors (e.g., duplicate plugin).
  - Warns about potential data deletion on deactivation.

---

## Bootstrapping

- The file-level `WPBC()` function returns the singleton instance (`Booking_Calendar::init()`), and is called at the end.
- Ensures plugin starts when file is loaded.

---

## Summary

The `Booking_Calendar` class is the backbone of the Booking Calendar plugin, managing everything from the initialization sequence, admin UI, and resource loading to system integration, error messaging, and singleton enforcement.  
Its structure ensures robust, centralized control of plugin lifecycle and features.

---

*Generated by Copilot for repository @lstroh/Booking-Calendar*